define("jquery",[],function(){return window.jQuery}),define("underscore",[],function(){return window._}),define("backbone",[],function(){return window.Backbone}),define("components/common/select-list",["exports","jquery","underscore","backbone"],function(e,t,n,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var s=i(t),o=i(n),u=i(r),a=null,f=u["default"].Collection.extend({initialize:function(t){this.options=t},parse:function(t){return this.options.parse.call(this,t)},fetch:function(t){var n=s["default"].extend({page:1,pageSize:100},t.data||{}),r=s["default"].extend({},t,{data:n});this.settings={url:r.url,data:n},u["default"].Collection.prototype.fetch.call(this,r)},fetchNextPage:function(t){if(this.more){var n=this.settings.data.page+1,r=s["default"].extend(this.settings,t);r.data.page=n,r.remove=!1,this.fetch(r)}else t.error()}}),l=u["default"].View.extend({tagName:"li",template:function(t){return'<input class="select-list-list-checkbox" type="checkbox"><div class="select-list-list-item">'+t+"</div>"},events:{"change .select-list-list-checkbox":"toggle"},initialize:function(t){this.listenTo(this.model,"change",this.render),this.settings=t.settings},render:function(){this.$el.html(this.template(this.settings.format(this.model.toJSON()))),this.$("input").prop("name",this.model.get("name")),this.$el.toggleClass("selected",this.model.get("selected")),this.$(".select-list-list-checkbox").prop("title",this.model.get("selected")?this.settings.tooltips.deselect:this.settings.tooltips.select).prop("checked",this.model.get("selected")),this.settings.readOnly&&this.$(".select-list-list-checkbox").prop("disabled",!0)},remove:function(t){if(t){var n=this;n.$el.addClass(this.model.get("selected")?"added":"removed"),setTimeout(function(){u["default"].View.prototype.remove.call(n,arguments)},500)}else u["default"].View.prototype.remove.call(this,arguments)},toggle:function(){var t=this.model.get("selected"),n=this,r=t?this.settings.deselectUrl:this.settings.selectUrl,i=s["default"].extend({},this.settings.extra||{});i[this.settings.selectParameter]=this.model.get(this.settings.selectParameterValue),n.$el.addClass("progress"),s["default"].ajax({url:r,type:"POST",data:i,statusCode:{400:null,401:null,403:null,500:null}}).done(function(){n.model.set("selected",!t)}).fail(function(e){n.render(),a(e)}).always(function(){n.$el.removeClass("progress")})}}),c=u["default"].View.extend({template:function(t){return'<div class="select-list-container"><div class="select-list-control"><div class="select-list-check-control"><a class="select-list-control-button" name="selected">'+t.selected+"</a>"+'<a class="select-list-control-button" name="deselected">'+t.deselected+"</a>"+'<a class="select-list-control-button" name="all">'+t.all+"</a>"+"</div>"+'<div class="select-list-search-control">'+'<form class="search-box">'+'<span class="search-box-submit button-clean"><i class="icon-search"></i></span>'+'<input class="search-box-input" type="search" name="q" placeholder="Search" maxlength="100" autocomplete="off">'+"</form>"+"</div>"+"</div>"+'<div class="select-list-list-container">'+'<ul class="select-list-list"></ul>'+"</div>"+"</div>"},events:{"click .select-list-control-button[name=selected]":"showSelected","click .select-list-control-button[name=deselected]":"showDeselected","click .select-list-control-button[name=all]":"showAll"},initialize:function(t){this.listenTo(this.collection,"add",this.renderListItem),this.listenTo(this.collection,"reset",this.renderList),this.listenTo(this.collection,"remove",this.removeModel),this.listenTo(this.collection,"change:selected",this.confirmFilter),this.settings=t.settings;var n=this;this.showFetchSpinner=function(){n.$listContainer.addClass("loading")},this.hideFetchSpinner=function(){n.$listContainer.removeClass("loading")};var r=function(){n.showFetchSpinner(),n.collection.fetchNextPage({success:function(){n.hideFetchSpinner()},error:function(){n.hideFetchSpinner()}})};this.onScroll=o["default"].throttle(r,1e3)},render:function(){var t=this,n=function(){t.search()};this.$el.html(this.template(this.settings.labels)).width(this.settings.width),this.$listContainer=this.$(".select-list-list-container"),this.settings.readOnly?this.$listContainer.addClass("select-list-list-container-readonly"):this.$listContainer.height(this.settings.height).css("overflow","auto").on("scroll",function(){t.scroll()}),this.$list=this.$(".select-list-list");var r=this.$(".select-list-search-control input").on("keyup",o["default"].debounce(n,250)).on("search",o["default"].debounce(n,250));this.settings.focusSearch&&setTimeout(function(){r.focus()},250),this.listItemViews=[],a=function(e){var n=window.t("default_error_message");e!=null&&e.responseJSON!=null&&e.responseJSON.errors!=null&&(n=o["default"].pluck(e.responseJSON.errors,"msg").join(". ")),t.$el.prevAll(".alert").remove(),(0,s["default"])("<div>").addClass("alert alert-danger").text(n).insertBefore(t.$el)},this.settings.readOnly&&this.$(".select-list-control").remove()},renderList:function(){this.listItemViews.forEach(function(e){e.remove()}),this.listItemViews=[],this.collection.length>0?this.collection.each(this.renderListItem,this):this.settings.readOnly&&this.renderEmpty(),this.$listContainer.scrollTop(0)},renderListItem:function(t){var n=new l({model:t,settings:this.settings});this.listItemViews.push(n),this.$list.append(n.el),n.render()},renderEmpty:function(){this.$list.append('<li class="empty-message">'+this.settings.labels.noResults+"</li>")},confirmFilter:function(t){this.currentFilter!=="all"&&this.collection.remove(t)},removeModel:function(t,n,r){this.listItemViews[r.index].remove(!0),this.listItemViews.splice(r.index,1)},filterBySelection:function(t){var n=this;t=this.currentFilter=t||this.currentFilter,t!=null&&(this.$(".select-list-check-control").toggleClass("disabled",!1),this.$(".select-list-search-control").toggleClass("disabled",!0),this.$(".select-list-search-control input").val(""),this.$(".select-list-control-button").removeClass("active").filter("[name="+t+"]").addClass("active"),this.showFetchSpinner(),this.collection.fetch({url:this.settings.searchUrl,reset:!0,data:{selected:t},success:function(){n.hideFetchSpinner()},error:a}))},showSelected:function(){this.filterBySelection("selected")},showDeselected:function(){this.filterBySelection("deselected")},showAll:function(){this.filterBySelection("all")},search:function(){var t=this.$(".select-list-search-control input").val(),n=t.length>0,r=this,i={};this.$(".select-list-check-control").toggleClass("disabled",n),this.$(".select-list-search-control").toggleClass("disabled",!n),n?(this.showFetchSpinner(),this.currentFilter="all",i[this.settings.queryParam]=t,i.selected="all",this.collection.fetch({url:this.settings.searchUrl,reset:!0,data:i,success:function(){r.hideFetchSpinner()},error:a})):this.filterBySelection()},searchByQuery:function(t){this.$(".select-list-search-control input").val(t),this.search()},clearSearch:function(){this.filterBySelection()},scroll:function(){var t=this.$listContainer.scrollTop()>=this.$list[0].scrollHeight-this.$listContainer.outerHeight();t&&this.collection.more&&this.onScroll()}});window.SelectList=function(e){return this.settings=s["default"].extend(window.SelectList.defaults,e),this.collection=new f({parse:this.settings.parse}),this.view=new c({el:this.settings.el,collection:this.collection,settings:this.settings}),this.view.render(),this.filter("selected"),this},window.SelectList.prototype.filter=function(e){return this.view.filterBySelection(e),this},window.SelectList.prototype.search=function(e){return this.view.searchByQuery(e),this},window.SelectList.defaults={width:"50%",height:400,readOnly:!1,focusSearch:!0,format:function(t){return t.value},parse:function(t){return this.more=t.more,t.results},queryParam:"query",labels:{selected:"Selected",deselected:"Deselected",all:"All",noResults:""},tooltips:{select:"Click this to select item",deselect:"Click this to deselect item"},errorMessage:"Something gone wrong, try to reload the page and try again."}});