define("backbone.marionette",[],function(){return window.Marionette}),this.Templates=this.Templates||{},this.Templates["users-change-password"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<form id="change-user-password-form" autocomplete="off">\n  <div class="modal-head">\n    <h2>Change Password</h2>\n  </div>\n  <div class="modal-body">\n    <div class="js-modal-messages"></div>\n    <div class="modal-field">\n      <label for="change-user-password-password">New Password<em class="mandatory">*</em></label>\n      <input id="change-user-password-password-fake" name="password-fake" type="password" class="hidden">\n      <input id="change-user-password-password" name="password" type="password" size="50" maxlength="50" required>\n    </div>\n    <div class="modal-field">\n      <label for="change-user-password-password-confirmation">Confirm Password<em class="mandatory">*</em></label>\n      <input id="change-user-password-password-confirmation-fake" name="password-confirmation-fake" type="password" class="hidden">\n      <input id="change-user-password-password-confirmation" name="password-confirmation" type="password" size="50" maxlength="50" required>\n    </div>\n  </div>\n  <div class="modal-foot">\n    <button id="change-user-password-submit">Change</button>\n    <a href="#" class="js-modal-close" id="change-user-password-cancel">Cancel</a>\n  </div>\n</form>\n'},useData:!0}),this.Templates["users-deactivate"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i,s="function",o=t.helperMissing,u=this.escapeExpression;return'<form id="deactivate-user-form" autocomplete="off">\n  <div class="modal-head">\n    <h2>Deactivate User</h2>\n  </div>\n  <div class="modal-body">\n    <div class="js-modal-messages"></div>\n    Are you sure you want to deactivate "'+u((i=(i=t.name||(e!=null?e.name:e))!=null?i:o,typeof i===s?i.call(e,{name:"name",hash:{},data:r}):i))+" ("+u((i=(i=t.login||(e!=null?e.login:e))!=null?i:o,typeof i===s?i.call(e,{name:"login",hash:{},data:r}):i))+')"?\n  </div>\n  <div class="modal-foot">\n    <button id="deactivate-user-submit">Deactivate</button>\n    <a href="#" class="js-modal-close" id="deactivate-user-cancel">Cancel</a>\n  </div>\n</form>\n'},useData:!0}),this.Templates["users-form"]=Handlebars.template({1:function(e,t,n,r){return"Update"},3:function(e,t,n,r){return"Create"},5:function(e,t,n,r){var i,s="function",o=t.helperMissing,u=this.escapeExpression;return'      <div class="modal-field">\n        <label for="create-user-login">Login<em class="mandatory">*</em></label>\n        <input id="create-user-login-fake" name="login-fake" type="text" class="hidden">\n        <input id="create-user-login" name="login" type="text" size="50" minlength="3" maxlength="255" required\n            value="'+u((i=(i=t.login||(e!=null?e.login:e))!=null?i:o,typeof i===s?i.call(e,{name:"login",hash:{},data:r}):i))+'">\n        <p class="note">Minimum 3 characters</p>\n      </div>\n'},7:function(e,t,n,r){return'      <div class="modal-field">\n        <label for="create-user-password">Password<em class="mandatory">*</em></label>\n        <input id="create-user-password-fake" name="password-fake" type="password" class="hidden">\n        <input id="create-user-password" name="password" type="password" size="50" maxlength="50" required>\n      </div>\n'},9:function(e,t,n,r){var i=this.lambda,s=this.escapeExpression;return'        <input name="scmAccounts" type="text" size="50" maxlength="255" value="'+s(i(e,e))+'">\n'},11:function(e,t,n,r){return'        <input name="scmAccounts" type="text" size="50" maxlength="255">\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i,s,o="function",u=t.helperMissing,a=this.escapeExpression,f='<form id="create-user-form" autocomplete="off">\n  <div class="modal-head">\n    <h2>';return i=t["if"].call(e,e!=null?e.login:e,{name:"if",hash:{},fn:this.program(1,r),inverse:this.program(3,r),data:r}),i!=null&&(f+=i),f+=' User</h2>\n  </div>\n  <div class="modal-body">\n    <div class="js-modal-messages"></div>\n',i=t.unless.call(e,e!=null?e.login:e,{name:"unless",hash:{},fn:this.program(5,r),inverse:this.noop,data:r}),i!=null&&(f+=i),f+='    <div class="modal-field">\n      <label for="create-user-name">Name<em class="mandatory">*</em></label>\n      <input id="create-user-name-fake" name="name-fake" type="text" class="hidden">\n      <input id="create-user-name" name="name" type="text" size="50" maxlength="200" required value="'+a((s=(s=t.name||(e!=null?e.name:e))!=null?s:u,typeof s===o?s.call(e,{name:"name",hash:{},data:r}):s))+'">\n    </div>\n    <div class="modal-field">\n      <label for="create-user-email">Email</label>\n      <input id="create-user-email-fake" name="email-fake" type="email" class="hidden">\n      <input id="create-user-email" name="email" type="email" size="50" maxlength="100" value="'+a((s=(s=t.email||(e!=null?e.email:e))!=null?s:u,typeof s===o?s.call(e,{name:"email",hash:{},data:r}):s))+'">\n    </div>\n',i=t.unless.call(e,e!=null?e.login:e,{name:"unless",hash:{},fn:this.program(7,r),inverse:this.noop,data:r}),i!=null&&(f+=i),f+='    <div class="modal-field">\n      <label>SCM Accounts</label>\n',i=t.each.call(e,e!=null?e.scmAccounts:e,{name:"each",hash:{},fn:this.program(9,r),inverse:this.program(11,r),data:r}),i!=null&&(f+=i),f+='      <a id="create-user-add-scm-account" class="icon-plus" href="#" title="Add another SCM account"\n         data-toggle="tooltip"></a>\n      <p class="note">Note that login and email are automatically considered as SCM accounts</p>\n    </div>\n  </div>\n  <div class="modal-foot">\n    <button id="create-user-submit">',i=t["if"].call(e,e!=null?e.login:e,{name:"if",hash:{},fn:this.program(1,r),inverse:this.program(3,r),data:r}),i!=null&&(f+=i),f+'</button>\n    <a href="#" class="js-modal-close" id="create-user-cancel">Cancel</a>\n  </div>\n</form>\n'},useData:!0}),this.Templates["users-groups"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<div class="modal-head">\n  <h2>Update Groups</h2>\n</div>\n<div class="modal-body">\n  <div class="js-modal-messages"></div>\n  <div id="users-groups"></div>\n</div>\n<div class="modal-foot">\n  <a href="#" class="js-modal-close" id="users-groups-done">Done</a>\n</div>\n'},useData:!0}),this.Templates["users-header"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i=t.helperMissing,s=this.escapeExpression;return'<header class="page-header">\n  <h1 class="page-title">'+s((t.t||e&&e.t||i).call(e,"users.page",{name:"t",hash:{},data:r}))+'</h1>\n  <div class="page-actions">\n    <div class="button-group">\n      <button id="users-create">Create User</button>\n    </div>\n  </div>\n  <p class="page-description">'+s((t.t||e&&e.t||i).call(e,"users.page.description",{name:"t",hash:{},data:r}))+"</p>\n</header>\n"},useData:!0}),this.Templates["users-layout"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<div class="page">\n  <div id="users-header"></div>\n  <div id="users-search"></div>\n  <div id="users-list"></div>\n  <div id="users-list-footer"></div>\n</div>\n'},useData:!0}),this.Templates["users-list-footer"]=Handlebars.template({1:function(e,t,n,r){return'    <a id="users-fetch-more" class="spacer-left" href="#">show more</a>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i,s,o="function",u=t.helperMissing,a=this.escapeExpression,f='<footer class="spacer-top note text-center">\n  '+a((s=(s=t.count||(e!=null?e.count:e))!=null?s:u,typeof s===o?s.call(e,{name:"count",hash:{},data:r}):s))+"/"+a((s=(s=t.total||(e!=null?e.total:e))!=null?s:u,typeof s===o?s.call(e,{name:"total",hash:{},data:r}):s))+" shown\n";return i=t["if"].call(e,e!=null?e.more:e,{name:"if",hash:{},fn:this.program(1,r),inverse:this.noop,data:r}),i!=null&&(f+=i),f+"</footer>\n"},useData:!0}),this.Templates["users-list-item"]=Handlebars.template({1:function(e,t,n,r){var i=t.helperMissing,s=this.escapeExpression;return'  <div class="display-inline-block text-top big-spacer-right">\n    '+s((t.avatarHelper||e&&e.avatarHelper||i).call(e,e!=null?e.email:e,36,{name:"avatarHelper",hash:{},data:r}))+"\n  </div>\n"},3:function(e,t,n,r){var i,s=t.helperMissing,o='    <div class="pull-left spacer-right">\n      <strong>SCM</strong>\n    </div>\n    <ul class="overflow-hidden bordered-left">\n';return i=t.each.call(e,e!=null?e.firstScmAccounts:e,{name:"each",hash:{},fn:this.program(4,r),inverse:this.noop,data:r}),i!=null&&(o+=i),i=(t.gt||e&&e.gt||s).call(e,e!=null?e.moreScmAccountsCount:e,0,{name:"gt",hash:{},fn:this.program(6,r),inverse:this.noop,data:r}),i!=null&&(o+=i),o+"    </ul>\n"},4:function(e,t,n,r){var i=this.lambda,s=this.escapeExpression;return'        <li class="spacer-left little-spacer-bottom">'+s(i(e,e))+"</li>\n"},6:function(e,t,n,r){var i,s="function",o=t.helperMissing,u=this.escapeExpression;return'        <li class="spacer-left little-spacer-bottom">\n          <a class="js-user-more-scm" href="#">'+u((i=(i=t.moreScmAccountsCount||(e!=null?e.moreScmAccountsCount:e))!=null?i:o,typeof i===s?i.call(e,{name:"moreScmAccountsCount",hash:{},data:r}):i))+" more</a>\n        </li>\n"},8:function(e,t,n,r){var i=this.lambda,s=this.escapeExpression;return'      <li class="spacer-left little-spacer-bottom">'+s(i(e,e))+"</li>\n"},10:function(e,t,n,r){var i,s="function",o=t.helperMissing,u=this.escapeExpression;return'        <a class="js-user-more-groups spacer-right" href="#">'+u((i=(i=t.moreGroupsCount||(e!=null?e.moreGroupsCount:e))!=null?i:o,typeof i===s?i.call(e,{name:"moreGroupsCount",hash:{},data:r}):i))+" more</a>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i,s,o,u="function",a=t.helperMissing,f=t.blockHelperMissing,l=this.escapeExpression,c='<div class="pull-right big-spacer-left nowrap">\n  <a class="js-user-update icon-edit little-spacer-right" title="Update Details" data-toggle="tooltip" href="#"></a>\n  <a class="js-user-change-password icon-lock little-spacer-right" title="Change Password" data-toggle="tooltip"\n     href="#"></a>\n  <a class="js-user-deactivate icon-delete" title="Deactivate" data-toggle="tooltip" href="#"></a>\n</div>\n\n';return i=(s=(s=t.ifShowAvatars||(e!=null?e.ifShowAvatars:e))!=null?s:a,o={name:"ifShowAvatars",hash:{},fn:this.program(1,r),inverse:this.noop,data:r},typeof s===u?s.call(e,o):s),t.ifShowAvatars||(i=f.call(e,i,o)),i!=null&&(c+=i),c+='\n<div class="display-inline-block text-top width-30">\n  <div>\n    <strong class="js-user-name">'+l((s=(s=t.name||(e!=null?e.name:e))!=null?s:a,typeof s===u?s.call(e,{name:"name",hash:{},data:r}):s))+'</strong>\n    <span class="js-user-login note little-spacer-left">'+l((s=(s=t.login||(e!=null?e.login:e))!=null?s:a,typeof s===u?s.call(e,{name:"login",hash:{},data:r}):s))+'</span>\n  </div>\n  <div class="js-user-email little-spacer-top">'+l((s=(s=t.email||(e!=null?e.email:e))!=null?s:a,typeof s===u?s.call(e,{name:"email",hash:{},data:r}):s))+'</div>\n</div>\n\n<div class="display-inline-block text-top big-spacer-left width-25">\n',i=(t.notEmpty||e&&e.notEmpty||a).call(e,e!=null?e.scmAccounts:e,{name:"notEmpty",hash:{},fn:this.program(3,r),inverse:this.noop,data:r}),i!=null&&(c+=i),c+='</div>\n\n<div class="display-inline-block text-top big-spacer-left width-25">\n  <div class="pull-left spacer-right">\n    <strong>Groups</strong>\n  </div>\n  <ul class="overflow-hidden bordered-left">\n',i=t.each.call(e,e!=null?e.firstGroups:e,{name:"each",hash:{},fn:this.program(8,r),inverse:this.noop,data:r}),i!=null&&(c+=i),c+='    <li class="spacer-left little-spacer-bottom">\n',i=(t.gt||e&&e.gt||a).call(e,e!=null?e.moreGroupsCount:e,0,{name:"gt",hash:{},fn:this.program(10,r),inverse:this.noop,data:r}),i!=null&&(c+=i),c+'      <a class="js-user-groups icon-bullet-list" title="Update Groups" data-toggle="tooltip" href="#"></a>\n    </li>\n  </ul>\n</div>\n'},useData:!0}),this.Templates["users-search"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<div class="panel panel-vertical bordered-bottom spacer-bottom">\n  <form id="users-search-form" class="search-box">\n    <button id="users-search-submit" class="search-box-submit button-clean"><i class="icon-search"></i></button>\n    <input id="users-search-query" class="search-box-input" type="search" name="q" placeholder="Search" maxlength="100">\n  </form>\n</div>\n'},useData:!0}),define("apps/users/templates",function(){}),define("apps/users/layout",["exports","module","backbone.marionette","./templates"],function(e,t,n,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var s=i(n);t.exports=s["default"].LayoutView.extend({template:Templates["users-layout"],regions:{headerRegion:"#users-header",searchRegion:"#users-search",listRegion:"#users-list",listFooterRegion:"#users-list-footer"}})}),define("backbone",[],function(){return window.Backbone}),define("underscore",[],function(){return window._}),define("apps/users/user",["exports","module","underscore","backbone"],function(e,t,n,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var s=i(n),o=i(r);t.exports=o["default"].Model.extend({idAttribute:"login",urlRoot:function(){return baseUrl+"/api/users"},defaults:function(){return{groups:[],scmAccounts:[]}},toQuery:function(){var t=this.toJSON();return s["default"].each(t,function(e,n){s["default"].isArray(e)&&(t[n]=e.join(","))}),t},isNew:function(){return this.has("password")},sync:function(t,n,r){var i=r||{};return t==="create"&&s["default"].defaults(i,{url:this.urlRoot()+"/create",type:"POST",data:s["default"].pick(n.toQuery(),"login","name","email","password","scmAccounts")}),t==="update"&&s["default"].defaults(i,{url:this.urlRoot()+"/update",type:"POST",data:s["default"].pick(n.toQuery(),"login","name","email","scmAccounts")}),t==="delete"&&s["default"].defaults(i,{url:this.urlRoot()+"/deactivate",type:"POST",data:{login:this.id}}),o["default"].ajax(i)},changePassword:function(t,n){var r=s["default"].defaults(n||{},{url:this.urlRoot()+"/change_password",type:"POST",data:{login:this.id,password:t}});return o["default"].ajax(r)}})}),define("apps/users/users",["exports","module","backbone","./user"],function(e,t,n,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var s=i(n),o=i(r);t.exports=s["default"].Collection.extend({model:o["default"],url:function(){return baseUrl+"/api/users/search"},parse:function(t){return this.total=+t.total,this.p=+t.p,this.ps=+t.ps,t.users},fetch:function(t){var n=t&&t.data||{};return this.q=n.q,this._super(t)},fetchMore:function(){var t=this.p+1;return this.fetch({add:!0,remove:!1,data:{p:t,ps:this.ps,q:this.q}})},refresh:function(){return this.fetch({reset:!0,data:{q:this.q}})},hasMore:function(){return this.total>this.p*this.ps}})}),define("jquery",[],function(){return window.jQuery}),define("components/common/modals",["exports","module","jquery","backbone.marionette"],function(e,t,n,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var s=i(n),o=i(r),u="modal";t.exports=o["default"].ItemView.extend({className:"modal",overlayClassName:"modal-overlay",htmlClassName:"modal-open",events:function(){return{"click .js-modal-close":"onCloseClick"}},onRender:function(){var t=this;this.$el.detach().appendTo((0,s["default"])("body")),(0,s["default"])("html").addClass(this.htmlClassName),this.renderOverlay(),this.keyScope=key.getScope(),key.setScope("modal"),key("escape","modal",function(){return t.destroy(),!1}),this.show(),!this.options.large||this.$el.addClass("modal-large")},show:function(){var t=this;setTimeout(function(){t.$el.addClass("in"),(0,s["default"])("."+t.overlayClassName).addClass("in")},0)},onDestroy:function(){(0,s["default"])("html").removeClass(this.htmlClassName),this.removeOverlay(),key.deleteScope("modal"),key.setScope(this.keyScope)},onCloseClick:function(t){t.preventDefault(),this.destroy()},renderOverlay:function(){var t=(0,s["default"])("."+this.overlayClassName);t.length===0&&(0,s["default"])('<div class="'+this.overlayClassName+'"></div>').appendTo((0,s["default"])("body"))},removeOverlay:function(){(0,s["default"])("."+this.overlayClassName).remove()},attachCloseEvents:function(){var t=this;(0,s["default"])("body").on("click."+u,function(){(0,s["default"])("body").off("click."+u),t.destroy()})}})}),define("components/common/modal-form",["exports","module","underscore","components/common/modals"],function(e,t,n,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var s=i(n),o=i(r);t.exports=o["default"].extend({ui:function(){return{messagesContainer:".js-modal-messages"}},events:function(){return s["default"].extend(o["default"].prototype.events.apply(this,arguments),{"keydown input,textarea,select":"onInputKeydown","submit form":"onFormSubmit"})},onRender:function(){o["default"].prototype.onRender.apply(this,arguments);var t=this;setTimeout(function(){t.$(":tabbable").first().focus()},0)},onInputKeydown:function(t){t.keyCode===27&&this.destroy()},onFormSubmit:function(t){t.preventDefault()},showErrors:function(t,n){var r=this.ui.messagesContainer.empty();s["default"].isArray(t)&&t.forEach(function(e){var t='<div class="alert alert-danger">'+e.msg+"</div>";r.append(t)}),s["default"].isArray(n)&&n.forEach(function(e){var t='<div class="alert alert-warning">'+e.msg+"</div>";r.append(t)}),this.ui.messagesContainer.scrollParent().scrollTop(0)},disableForm:function(){var t=this.$("form");this.disabledFields=t.find(":input:not(:disabled)"),this.disabledFields.prop("disabled",!0)},enableForm:function(){this.disabledFields!=null&&this.disabledFields.prop("disabled",!1)}})}),define("apps/users/form-view",["exports","module","jquery","underscore","components/common/modal-form","./templates"],function(e,t,n,r,i,s){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var u=o(n),a=o(r),f=o(i);t.exports=f["default"].extend({template:Templates["users-form"],events:function(){return a["default"].extend(this._super(),{"click #create-user-add-scm-account":"onAddScmAccountClick"})},onRender:function(){this._super(),this.$('[data-toggle="tooltip"]').tooltip({container:"body",placement:"bottom"})},onDestroy:function(){this._super(),this.$('[data-toggle="tooltip"]').tooltip("destroy")},onFormSubmit:function(t){this._super(t),this.sendRequest()},onAddScmAccountClick:function(t){t.preventDefault(),this.addScmAccount()},getScmAccounts:function(){var t=this.$('[name="scmAccounts"]').map(function(){return(0,u["default"])(this).val()}).toArray();return t.filter(function(e){return!!e})},addScmAccount:function(){var t=this.$('[name="scmAccounts"]');t.first().clone().val("").insertAfter(t.last())}})}),define("apps/users/create-view",["exports","module","./user","./form-view"],function(e,t,n,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var s=i(n),o=i(r);t.exports=o["default"].extend({sendRequest:function(){var t=this,n=new s["default"]({login:this.$("#create-user-login").val(),name:this.$("#create-user-name").val(),email:this.$("#create-user-email").val(),password:this.$("#create-user-password").val(),scmAccounts:this.getScmAccounts()});return this.disableForm(),n.save(null,{statusCode:{400:null,500:null}}).done(function(){t.collection.refresh(),t.destroy()}).fail(function(e){t.enableForm(),t.showErrors(e.responseJSON.errors,e.responseJSON.warnings)})}})}),define("apps/users/header-view",["exports","module","backbone.marionette","./create-view","./templates"],function(e,t,n,r,i){"use strict";function s(e){return e&&e.__esModule?e:{"default":e}}var o=s(n),u=s(r);t.exports=o["default"].ItemView.extend({template:Templates["users-header"],events:{"click #users-create":"onCreateClick"},onCreateClick:function(t){t.preventDefault(),this.createUser()},createUser:function(){(new u["default"]({collection:this.collection})).render()}})}),define("apps/users/search-view",["exports","module","underscore","backbone.marionette","./templates"],function(e,t,n,r,i){"use strict";function s(e){return e&&e.__esModule?e:{"default":e}}var o=s(n),u=s(r);t.exports=u["default"].ItemView.extend({template:Templates["users-search"],events:{"submit #users-search-form":"onFormSubmit","search #users-search-query":"debouncedOnKeyUp","keyup #users-search-query":"debouncedOnKeyUp"},initialize:function(){this._bufferedValue=null,this.debouncedOnKeyUp=o["default"].debounce(this.onKeyUp,400)},onRender:function(){this.delegateEvents()},onFormSubmit:function(t){t.preventDefault(),this.debouncedOnKeyUp()},onKeyUp:function(){var t=this.getQuery();if(t===this._bufferedValue)return;this._bufferedValue=this.getQuery(),this.searchRequest!=null&&this.searchRequest.abort(),this.searchRequest=this.search(t)},getQuery:function(){return this.$("#users-search-query").val()},search:function(t){return this.collection.fetch({reset:!0,data:{q:t}})}})}),define("apps/users/update-view",["exports","module","./form-view"],function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=r(n);t.exports=i["default"].extend({sendRequest:function(){var t=this;return this.model.set({name:this.$("#create-user-name").val(),email:this.$("#create-user-email").val(),scmAccounts:this.getScmAccounts()}),this.disableForm(),this.model.save(null,{statusCode:{400:null}}).done(function(){t.collection.refresh(),t.destroy()}).fail(function(e){t.enableForm(),t.showErrors(e.responseJSON.errors,e.responseJSON.warnings)})}})}),define("apps/users/change-password-view",["exports","module","components/common/modal-form","./templates"],function(e,t,n,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var s=i(n);t.exports=s["default"].extend({template:Templates["users-change-password"],onFormSubmit:function(t){this._super(t),this.sendRequest()},sendRequest:function(){var t=this,n=this.$("#change-user-password-password").val(),r=this.$("#change-user-password-password-confirmation").val();if(n!==r){t.showErrors([{msg:"New password and its confirmation do not match"}]);return}return this.disableForm(),this.model.changePassword(n,{statusCode:{400:null}}).done(function(){t.destroy()}).fail(function(e){t.enableForm(),t.showErrors(e.responseJSON.errors,e.responseJSON.warnings)})}})}),define("apps/users/deactivate-view",["exports","module","components/common/modal-form","./templates"],function(e,t,n,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var s=i(n);t.exports=s["default"].extend({template:Templates["users-deactivate"],onFormSubmit:function(t){this._super(t),this.sendRequest()},sendRequest:function(){var t=this,n=this.model.collection;return this.model.destroy({wait:!0,statusCode:{400:null}}).done(function(){n.total--,t.destroy()}).fail(function(e){t.showErrors(e.responseJSON.errors,e.responseJSON.warnings)})}})}),define("components/common/select-list",["exports","jquery","underscore","backbone"],function(e,t,n,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var s=i(t),o=i(n),u=i(r),a=null,f=u["default"].Collection.extend({initialize:function(t){this.options=t},parse:function(t){return this.options.parse.call(this,t)},fetch:function(t){var n=s["default"].extend({page:1,pageSize:100},t.data||{}),r=s["default"].extend({},t,{data:n});this.settings={url:r.url,data:n},u["default"].Collection.prototype.fetch.call(this,r)},fetchNextPage:function(t){if(this.more){var n=this.settings.data.page+1,r=s["default"].extend(this.settings,t);r.data.page=n,r.remove=!1,this.fetch(r)}else t.error()}}),l=u["default"].View.extend({tagName:"li",template:function(t){return'<input class="select-list-list-checkbox" type="checkbox"><div class="select-list-list-item">'+t+"</div>"},events:{"change .select-list-list-checkbox":"toggle"},initialize:function(t){this.listenTo(this.model,"change",this.render),this.settings=t.settings},render:function(){this.$el.html(this.template(this.settings.format(this.model.toJSON()))),this.$("input").prop("name",this.model.get("name")),this.$el.toggleClass("selected",this.model.get("selected")),this.$(".select-list-list-checkbox").prop("title",this.model.get("selected")?this.settings.tooltips.deselect:this.settings.tooltips.select).prop("checked",this.model.get("selected")),this.settings.readOnly&&this.$(".select-list-list-checkbox").prop("disabled",!0)},remove:function(t){if(t){var n=this;n.$el.addClass(this.model.get("selected")?"added":"removed"),setTimeout(function(){u["default"].View.prototype.remove.call(n,arguments)},500)}else u["default"].View.prototype.remove.call(this,arguments)},toggle:function(){var t=this.model.get("selected"),n=this,r=t?this.settings.deselectUrl:this.settings.selectUrl,i=s["default"].extend({},this.settings.extra||{});i[this.settings.selectParameter]=this.model.get(this.settings.selectParameterValue),n.$el.addClass("progress"),s["default"].ajax({url:r,type:"POST",data:i,statusCode:{400:null,401:null,403:null,500:null}}).done(function(){n.model.set("selected",!t)}).fail(function(e){n.render(),a(e)}).always(function(){n.$el.removeClass("progress")})}}),c=u["default"].View.extend({template:function(t){return'<div class="select-list-container"><div class="select-list-control"><div class="select-list-check-control"><a class="select-list-control-button" name="selected">'+t.selected+"</a>"+'<a class="select-list-control-button" name="deselected">'+t.deselected+"</a>"+'<a class="select-list-control-button" name="all">'+t.all+"</a>"+"</div>"+'<div class="select-list-search-control">'+'<form class="search-box">'+'<span class="search-box-submit button-clean"><i class="icon-search"></i></span>'+'<input class="search-box-input" type="search" name="q" placeholder="Search" maxlength="100" autocomplete="off">'+"</form>"+"</div>"+"</div>"+'<div class="select-list-list-container">'+'<ul class="select-list-list"></ul>'+"</div>"+"</div>"},events:{"click .select-list-control-button[name=selected]":"showSelected","click .select-list-control-button[name=deselected]":"showDeselected","click .select-list-control-button[name=all]":"showAll"},initialize:function(t){this.listenTo(this.collection,"add",this.renderListItem),this.listenTo(this.collection,"reset",this.renderList),this.listenTo(this.collection,"remove",this.removeModel),this.listenTo(this.collection,"change:selected",this.confirmFilter),this.settings=t.settings;var n=this;this.showFetchSpinner=function(){n.$listContainer.addClass("loading")},this.hideFetchSpinner=function(){n.$listContainer.removeClass("loading")};var r=function(){n.showFetchSpinner(),n.collection.fetchNextPage({success:function(){n.hideFetchSpinner()},error:function(){n.hideFetchSpinner()}})};this.onScroll=o["default"].throttle(r,1e3)},render:function(){var t=this,n=function(){t.search()};this.$el.html(this.template(this.settings.labels)).width(this.settings.width),this.$listContainer=this.$(".select-list-list-container"),this.settings.readOnly?this.$listContainer.addClass("select-list-list-container-readonly"):this.$listContainer.height(this.settings.height).css("overflow","auto").on("scroll",function(){t.scroll()}),this.$list=this.$(".select-list-list");var r=this.$(".select-list-search-control input").on("keyup",o["default"].debounce(n,250)).on("search",o["default"].debounce(n,250));this.settings.focusSearch&&setTimeout(function(){r.focus()},250),this.listItemViews=[],a=function(e){var n=window.t("default_error_message");e!=null&&e.responseJSON!=null&&e.responseJSON.errors!=null&&(n=o["default"].pluck(e.responseJSON.errors,"msg").join(". ")),t.$el.prevAll(".alert").remove(),(0,s["default"])("<div>").addClass("alert alert-danger").text(n).insertBefore(t.$el)},this.settings.readOnly&&this.$(".select-list-control").remove()},renderList:function(){this.listItemViews.forEach(function(e){e.remove()}),this.listItemViews=[],this.collection.length>0?this.collection.each(this.renderListItem,this):this.settings.readOnly&&this.renderEmpty(),this.$listContainer.scrollTop(0)},renderListItem:function(t){var n=new l({model:t,settings:this.settings});this.listItemViews.push(n),this.$list.append(n.el),n.render()},renderEmpty:function(){this.$list.append('<li class="empty-message">'+this.settings.labels.noResults+"</li>")},confirmFilter:function(t){this.currentFilter!=="all"&&this.collection.remove(t)},removeModel:function(t,n,r){this.listItemViews[r.index].remove(!0),this.listItemViews.splice(r.index,1)},filterBySelection:function(t){var n=this;t=this.currentFilter=t||this.currentFilter,t!=null&&(this.$(".select-list-check-control").toggleClass("disabled",!1),this.$(".select-list-search-control").toggleClass("disabled",!0),this.$(".select-list-search-control input").val(""),this.$(".select-list-control-button").removeClass("active").filter("[name="+t+"]").addClass("active"),this.showFetchSpinner(),this.collection.fetch({url:this.settings.searchUrl,reset:!0,data:{selected:t},success:function(){n.hideFetchSpinner()},error:a}))},showSelected:function(){this.filterBySelection("selected")},showDeselected:function(){this.filterBySelection("deselected")},showAll:function(){this.filterBySelection("all")},search:function(){var t=this.$(".select-list-search-control input").val(),n=t.length>0,r=this,i={};this.$(".select-list-check-control").toggleClass("disabled",n),this.$(".select-list-search-control").toggleClass("disabled",!n),n?(this.showFetchSpinner(),this.currentFilter="all",i[this.settings.queryParam]=t,i.selected="all",this.collection.fetch({url:this.settings.searchUrl,reset:!0,data:i,success:function(){r.hideFetchSpinner()},error:a})):this.filterBySelection()},searchByQuery:function(t){this.$(".select-list-search-control input").val(t),this.search()},clearSearch:function(){this.filterBySelection()},scroll:function(){var t=this.$listContainer.scrollTop()>=this.$list[0].scrollHeight-this.$listContainer.outerHeight();t&&this.collection.more&&this.onScroll()}});window.SelectList=function(e){return this.settings=s["default"].extend(window.SelectList.defaults,e),this.collection=new f({parse:this.settings.parse}),this.view=new c({el:this.settings.el,collection:this.collection,settings:this.settings}),this.view.render(),this.filter("selected"),this},window.SelectList.prototype.filter=function(e){return this.view.filterBySelection(e),this},window.SelectList.prototype.search=function(e){return this.view.searchByQuery(e),this},window.SelectList.defaults={width:"50%",height:400,readOnly:!1,focusSearch:!0,format:function(t){return t.value},parse:function(t){return this.more=t.more,t.results},queryParam:"query",labels:{selected:"Selected",deselected:"Deselected",all:"All",noResults:""},tooltips:{select:"Click this to select item",deselect:"Click this to deselect item"},errorMessage:"Something gone wrong, try to reload the page and try again."}}),define("apps/users/groups-view",["exports","module","components/common/modals","components/common/select-list","./templates"],function(e,t,n,r,i){"use strict";function s(e){return e&&e.__esModule?e:{"default":e}}var o=s(n);t.exports=o["default"].extend({template:Templates["users-groups"],itemTemplate:Templates["users-group"],onRender:function(){this._super(),new window.SelectList({el:this.$("#users-groups"),width:"100%",readOnly:!1,focusSearch:!1,format:function(t){return t.name+'<br><span class="note">'+t.description+"</span>"},queryParam:"q",searchUrl:baseUrl+"/api/users/groups?ps=100&login="+this.model.id,selectUrl:baseUrl+"/api/user_groups/add_user",deselectUrl:baseUrl+"/api/user_groups/remove_user",extra:{login:this.model.id},selectParameter:"id",selectParameterValue:"id",parse:function(t){return this.more=!1,t.groups}})},onDestroy:function(){this.model.collection.refresh(),o["default"].prototype.onDestroy.apply(this,arguments)}})}),define("apps/users/list-item-view",["exports","module","underscore","backbone.marionette","./update-view","./change-password-view","./deactivate-view","./groups-view","./templates"],function(e,t,n,r,i,s,o,u,a){"use strict";function f(e){return e&&e.__esModule?e:{"default":e}}var l=f(n),c=f(r),h=f(i),p=f(s),d=f(o),v=f(u);t.exports=c["default"].ItemView.extend({tagName:"li",className:"panel panel-vertical",template:Templates["users-list-item"],events:{"click .js-user-more-scm":"onMoreScmClick","click .js-user-more-groups":"onMoreGroupsClick","click .js-user-update":"onUpdateClick","click .js-user-change-password":"onChangePasswordClick","click .js-user-deactivate":"onDeactivateClick","click .js-user-groups":"onGroupsClick"},initialize:function(){this.scmLimit=3,this.groupsLimit=3},onRender:function(){this.$el.attr("data-login",this.model.id),this.$('[data-toggle="tooltip"]').tooltip({container:"body",placement:"bottom"})},onDestroy:function(){this.$('[data-toggle="tooltip"]').tooltip("destroy")},onMoreScmClick:function(t){t.preventDefault(),this.showMoreScm()},onMoreGroupsClick:function(t){t.preventDefault(),this.showMoreGroups()},onUpdateClick:function(t){t.preventDefault(),this.updateUser()},onChangePasswordClick:function(t){t.preventDefault(),this.changePassword()},onDeactivateClick:function(t){t.preventDefault(),this.deactivateUser()},onGroupsClick:function(t){t.preventDefault(),this.showGroups()},showMoreScm:function(){this.scmLimit=1e4,this.render()},showMoreGroups:function(){this.groupsLimit=1e4,this.render()},updateUser:function(){(new h["default"]({model:this.model,collection:this.model.collection})).render()},changePassword:function(){(new p["default"]({model:this.model,collection:this.model.collection})).render()},deactivateUser:function(){(new d["default"]({model:this.model})).render()},showGroups:function(){(new v["default"]({model:this.model})).render()},serializeData:function(){var t=this.model.get("scmAccounts"),n=t.length>this.scmLimit?this.scmLimit-1:this.scmLimit,r=this.model.get("groups"),i=r.length>this.groupsLimit?this.groupsLimit-1:this.groupsLimit;return l["default"].extend(this._super(),{firstScmAccounts:l["default"].first(t,n),moreScmAccountsCount:t.length-n,firstGroups:l["default"].first(r,i),moreGroupsCount:r.length-i})}})}),define("apps/users/list-view",["exports","module","backbone.marionette","./list-item-view","./templates"],function(e,t,n,r,i){"use strict";function s(e){return e&&e.__esModule?e:{"default":e}}var o=s(n),u=s(r);t.exports=o["default"].CollectionView.extend({tagName:"ul",childView:u["default"]})}),define("apps/users/list-footer-view",["exports","module","underscore","backbone.marionette","./templates"],function(e,t,n,r,i){"use strict";function s(e){return e&&e.__esModule?e:{"default":e}}var o=s(n),u=s(r);t.exports=u["default"].ItemView.extend({template:Templates["users-list-footer"],collectionEvents:{all:"render"},events:{"click #users-fetch-more":"onMoreClick"},onMoreClick:function(t){t.preventDefault(),this.fetchMore()},fetchMore:function(){this.collection.fetchMore()},serializeData:function(){return o["default"].extend(this._super(),{total:this.collection.total,count:this.collection.length,more:this.collection.hasMore()})}})}),define("apps/users/app",["exports","module","backbone.marionette","./layout","./users","./header-view","./search-view","./list-view","./list-footer-view"],function(e,t,n,r,i,s,o,u,a){"use strict";function f(e){return e&&e.__esModule?e:{"default":e}}var l=f(n),c=f(r),h=f(i),p=f(s),d=f(o),v=f(u),m=f(a),g=new l["default"].Application,y=function(t){this.layout=new c["default"]({el:t.el}),this.layout.render(),this.users=new h["default"],this.headerView=new p["default"]({collection:this.users}),this.layout.headerRegion.show(this.headerView),this.searchView=new d["default"]({collection:this.users}),this.layout.searchRegion.show(this.searchView),this.listView=new v["default"]({collection:this.users}),this.layout.listRegion.show(this.listView),this.listFooterView=new m["default"]({collection:this.users}),this.layout.listFooterRegion.show(this.listFooterView),this.users.fetch()};g.on("start",function(e){window.requestMessages().done(function(){y.call(g,e)})}),t.exports=g});