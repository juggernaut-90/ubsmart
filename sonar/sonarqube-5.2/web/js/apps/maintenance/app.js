define("underscore",[],function(){return window._}),define("backbone",[],function(){return window.Backbone}),define("backbone.marionette",[],function(){return window.Marionette}),define("jquery",[],function(){return window.jQuery}),Handlebars.registerPartial("_maintenance-state-migration-failed",Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<h1 class="maintenance-title text-danger">Upgrade Failed</h1>\n<p class="maintenance-text">Database connection cannot be established. Please check database status and JDBC settings.</p>\n'},useData:!0})),Handlebars.registerPartial("_maintenance-state-migration-not-supported",Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<h1 class="maintenance-title text-danger">Migration not supported</h1>\n<p>Migration is not supported on embedded databases.</p>\n'},useData:!0})),Handlebars.registerPartial("_maintenance-state-migration-required",Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){return'<h1 class="maintenance-title">Upgrade Database</h1>\n<p class="maintenance-text">The database upgrade can take several minutes.</p>\n<p class="maintenance-text">It is mandatory to <strong>back up database</strong> before upgrading.</p>\n<p class="maintenance-text"><strong>Copy the directory /extensions</strong> from previous version before upgrading.\n</p>\n<div class="maintenance-spinner">\n  <button id="start-migration">Upgrade</button>\n</div>\n'},useData:!0})),Handlebars.registerPartial("_maintenance-state-migration-running",Handlebars.template({1:function(e,t,n,r){var i,s="function",o=t.helperMissing,u=this.escapeExpression;return'  <p class="maintenance-text text-center">'+u((i=(i=t.message||(e!=null?e.message:e))!=null?i:o,typeof i===s?i.call(e,{name:"message",hash:{},data:r}):i))+"</p>\n"},3:function(e,t,n,r){var i=t.helperMissing,s=this.escapeExpression;return'  <p class="maintenance-text text-center">\n    Started '+s((t.fromNow||e&&e.fromNow||i).call(e,e!=null?e.startedAt:e,{name:"fromNow",hash:{},data:r}))+'<br>\n    <small class="text-muted">'+s((t.dt||e&&e.dt||i).call(e,e!=null?e.startedAt:e,{name:"dt",hash:{},data:r}))+"</small>\n  </p>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i,s='<h1 class="maintenance-title">Database Migration</h1>\n';return i=t["if"].call(e,e!=null?e.message:e,{name:"if",hash:{},fn:this.program(1,r),inverse:this.noop,data:r}),i!=null&&(s+=i),i=t["if"].call(e,e!=null?e.startedAt:e,{name:"if",hash:{},fn:this.program(3,r),inverse:this.noop,data:r}),i!=null&&(s+=i),s+'<p class="maintenance-spinner"><i class="spinner"></i></p>\n'},useData:!0})),Handlebars.registerPartial("_maintenance-state-migration-succeeded",Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i=t.helperMissing,s=this.escapeExpression;return'<h1 class="maintenance-title text-success">Database is up-to-date</h1>\n<p class="maintenance-text text-center">\n  <a href="'+s((t.link||e&&e.link||i).call(e,"/",{name:"link",hash:{},data:r}))+'">Go Home</a>\n</p>\n'},useData:!0})),Handlebars.registerPartial("_maintenance-state-no-migration",Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i=t.helperMissing,s=this.escapeExpression;return'<h1 class="maintenance-title">Database is up-to-date</h1>\n<p class="maintenance-text text-center">\n  <a href="'+s((t.link||e&&e.link||i).call(e,"/",{name:"link",hash:{},data:r}))+'">Go Home</a>\n</p>\n'},useData:!0})),Handlebars.registerPartial("_maintenance-status-down",Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i=t.helperMissing,s=this.escapeExpression;return'<h1 class="maintenance-title text-danger">SonarQube is down</h1>\n<p class="maintenance-text">Something went wrong. Please contact your system administrator.</p>\n<p class="maintenance-text text-center">\n  <a href="'+s((t.link||e&&e.link||i).call(e,"/",{name:"link",hash:{},data:r}))+'">Try Again</a>\n</p>\n'},useData:!0})),Handlebars.registerPartial("_maintenance-status-migration",Handlebars.template({1:function(e,t,n,r){return'  <p class="maintenance-spinner"><i class="spinner"></i></p>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i,s=t.helperMissing,o='<h1 class="maintenance-title">SonarQube is under maintenance</h1>\n<p class="maintenance-text">Whilst waiting, you might want to check\n  <a href="http://redirect.sonarsource.com/doc/plugin-library.html">new plugins</a> to extend the current functionality.\n</p>\n<p class="maintenance-text">If you are an administrator and have no idea why this message is showing, you should read the\n  <a href="http://redirect.sonarsource.com/doc/upgrading.html">upgrade guide</a>.\n</p>\n';return i=(t.eq||e&&e.eq||s).call(e,e!=null?e.status:e,"DB_MIGRATION_RUNNING",{name:"eq",hash:{},fn:this.program(1,r),inverse:this.noop,data:r}),i!=null&&(o+=i),o},useData:!0})),Handlebars.registerPartial("_maintenance-status-up",Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i=t.helperMissing,s=this.escapeExpression;return'<h1 class="maintenance-title">SonarQube is up</h1>\n<p class="maintenance-text text-center">All systems operational.</p>\n<p class="maintenance-text text-center">\n  <a href="'+s((t.link||e&&e.link||i).call(e,"/",{name:"link",hash:{},data:r}))+'">Go Home</a>\n</p>\n'},useData:!0})),this.Templates=this.Templates||{},this.Templates["maintenance-main"]=Handlebars.template({1:function(e,t,n,r){var i,s=t.helperMissing,o="\n  ";return i=(t.eq||e&&e.eq||s).call(e,e!=null?e.status:e,"UP",{name:"eq",hash:{},fn:this.program(2,r),inverse:this.noop,data:r}),i!=null&&(o+=i),o+="\n  ",i=(t.eq||e&&e.eq||s).call(e,e!=null?e.status:e,"DOWN",{name:"eq",hash:{},fn:this.program(4,r),inverse:this.noop,data:r}),i!=null&&(o+=i),o+="\n  ",i=(t.eq||e&&e.eq||s).call(e,e!=null?e.status:e,"DB_MIGRATION_NEEDED",{name:"eq",hash:{},fn:this.program(6,r),inverse:this.noop,data:r}),i!=null&&(o+=i),o+="\n  ",i=(t.eq||e&&e.eq||s).call(e,e!=null?e.status:e,"DB_MIGRATION_RUNNING",{name:"eq",hash:{},fn:this.program(6,r),inverse:this.noop,data:r}),i!=null&&(o+=i),o+"\n\n"},2:function(e,t,n,r){var i;return i=this.invokePartial(n["_maintenance-status-up"],"","_maintenance-status-up",e,undefined,t,n,r),i!=null?i:""},4:function(e,t,n,r){var i;return i=this.invokePartial(n["_maintenance-status-down"],"","_maintenance-status-down",e,undefined,t,n,r),i!=null?i:""},6:function(e,t,n,r){var i;return i=this.invokePartial(n["_maintenance-status-migration"],"","_maintenance-status-migration",e,undefined,t,n,r),i!=null?i:""},8:function(e,t,n,r){var i,s=t.helperMissing,o="\n  ";return i=(t.eq||e&&e.eq||s).call(e,e!=null?e.state:e,"NO_MIGRATION",{name:"eq",hash:{},fn:this.program(9,r),inverse:this.noop,data:r}),i!=null&&(o+=i),o+="\n  ",i=(t.eq||e&&e.eq||s).call(e,e!=null?e.state:e,"MIGRATION_REQUIRED",{name:"eq",hash:{},fn:this.program(11,r),inverse:this.noop,data:r}),i!=null&&(o+=i),o+="\n  ",i=(t.eq||e&&e.eq||s).call(e,e!=null?e.state:e,"NOT_SUPPORTED",{name:"eq",hash:{},fn:this.program(13,r),inverse:this.noop,data:r}),i!=null&&(o+=i),o+="\n  ",i=(t.eq||e&&e.eq||s).call(e,e!=null?e.state:e,"MIGRATION_RUNNING",{name:"eq",hash:{},fn:this.program(15,r),inverse:this.noop,data:r}),i!=null&&(o+=i),o+="\n  ",i=(t.eq||e&&e.eq||s).call(e,e!=null?e.state:e,"MIGRATION_SUCCEEDED",{name:"eq",hash:{},fn:this.program(17,r),inverse:this.noop,data:r}),i!=null&&(o+=i),o+="\n  ",i=(t.eq||e&&e.eq||s).call(e,e!=null?e.state:e,"MIGRATION_FAILED",{name:"eq",hash:{},fn:this.program(19,r),inverse:this.noop,data:r}),i!=null&&(o+=i),o+"\n\n"},9:function(e,t,n,r){var i;return i=this.invokePartial(n["_maintenance-state-no-migration"],"","_maintenance-state-no-migration",e,undefined,t,n,r),i!=null?i:""},11:function(e,t,n,r){var i;return i=this.invokePartial(n["_maintenance-state-migration-required"],"","_maintenance-state-migration-required",e,undefined,t,n,r),i!=null?i:""},13:function(e,t,n,r){var i;return i=this.invokePartial(n["_maintenance-state-migration-not-supported"],"","_maintenance-state-migration-not-supported",e,undefined,t,n,r),i!=null?i:""},15:function(e,t,n,r){var i;return i=this.invokePartial(n["_maintenance-state-migration-running"],"","_maintenance-state-migration-running",e,undefined,t,n,r),i!=null?i:""},17:function(e,t,n,r){var i;return i=this.invokePartial(n["_maintenance-state-migration-succeeded"],"","_maintenance-state-migration-succeeded",e,undefined,t,n,r),i!=null?i:""},19:function(e,t,n,r){var i;return i=this.invokePartial(n["_maintenance-state-migration-failed"],"","_maintenance-state-migration-failed",e,undefined,t,n,r),i!=null?i:""},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i,s="";return i=t.unless.call(e,e!=null?e.setup:e,{name:"unless",hash:{},fn:this.program(1,r),inverse:this.program(8,r),data:r}),i!=null&&(s+=i),s},usePartial:!0,useData:!0}),define("apps/maintenance/templates",function(){}),define("apps/maintenance/main-view",["exports","module","jquery","underscore","backbone","backbone.marionette","./templates"],function(e,t,n,r,i,s,o){"use strict";function u(e){return e&&e.__esModule?e:{"default":e}}var a=u(n),f=u(r),l=u(i),c=u(s);t.exports=c["default"].ItemView.extend({template:Templates["maintenance-main"],events:{"click #start-migration":"startMigration"},initialize:function(){var t=this;this.requestOptions={type:"GET",url:baseUrl+"/api/system/"+(this.options.setup?"db_migration_status":"status")},this.pollingInternal=setInterval(function(){t.refresh()},5e3)},refresh:function(){var t=this;return l["default"].ajax(this.requestOptions).done(function(e){t.model.set(e),t.render(),(t.model.get("status")==="UP"||t.model.get("state")==="NO_MIGRATION")&&t.stopPolling(),t.model.get("state")==="MIGRATION_SUCCEEDED"&&t.goHome()})},stopPolling:function(){clearInterval(this.pollingInternal)},startMigration:function(){var t=this;l["default"].ajax({url:baseUrl+"/api/system/migrate_db",type:"POST"}).done(function(e){t.model.set(e),t.render()})},onRender:function(){(0,a["default"])(".page-simple").toggleClass("panel-warning",this.model.get("state")==="MIGRATION_REQUIRED")},goHome:function(){setInterval(function(){window.location=baseUrl+"/"},2500)},serializeData:function(){return f["default"].extend(this._super(),{setup:this.options.setup})}})}),define("apps/maintenance/app",["exports","module","underscore","backbone","backbone.marionette","./main-view"],function(e,t,n,r,i,s){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}var u=o(n),a=o(r),f=o(i),l=o(s),c=new f["default"].Application;c.on("start",function(e){var t=u["default"].extend(e,{model:new a["default"].Model}),n=new l["default"](t);n.render().refresh()}),t.exports=c});